---
import { SiteSettingsGroqQuery } from "@lib/groq";
import "@styles/reset.scss";
import "@styles/global.scss";
import sanityClient from "@root/sanity";
import type { ListingProps, RecordProps, StoryProps } from "@lib/types.astro";
import NavigationMenu, { type HeaderProps } from "@components/NavigationMenu.astro";

export type NavigationItemProps = Exclude<RecordProps, StoryProps> | ListingProps;

export type SiteSettingsProps = {
	title: string;
	navigationItems: NavigationItemProps[];
};

const settings: SiteSettingsProps = await sanityClient.fetch(SiteSettingsGroqQuery);

type Props = {
	title: string;
	headerMode?: HeaderProps;
	clearHeaderColor?: string;
};

const {
	title,
	headerMode,
	clearHeaderColor,
} = Astro.props;
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
		<link rel="manifest" href="/site.webmanifest" />
		<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />
		<meta name="msapplication-TileColor" content="#da532c" />
		<meta name="theme-color" content="#fafafa" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0 viewport-fit=cover" />
		<meta name="generator" content={Astro.generator} />
		<title>{[title, settings.title]?.filter(Boolean)?.join(" â€¢ ")}</title>
	</head>
	<body>
		<NavigationMenu title={settings.title} items={settings.navigationItems} mode={headerMode} color={clearHeaderColor} />
		<main>
			<slot />
		</main>
		<footer></footer>
	</body>
</html>

<style lang="scss" is:global>
	body {
		display: flex;
		flex-flow: column nowrap;
		min-height: 100vh;
		min-height: 100dvh;
		--header-height: calc(1em * 4);
		--header-offset: var(--spacer-400);
		--body-inline-spacing: calc(var(--spacer-400) + env(safe-area-inset-left, 0px));
		@media (max-width: 640px) {
			--header-offset: 0px;
		}
	}
	main {
		flex: 1;
		display: flex;
		flex-flow: column nowrap;
		margin-inline: var(--body-inline-spacing);
	}
</style>