---
import type { SanityImageSource } from "@sanity/image-url/lib/types/types";
import sanityClient from "../sanity.js";
import imageUrlBuilder from "@sanity/image-url";

const imageBuilder = imageUrlBuilder(sanityClient);
function urlFor(source: SanityImageSource) {
	return imageBuilder.image(source);
};

const {
	source,
	alt = "",
	width,
	height,
	...rest
} = Astro.props;

const srcset =
	width && !height ? urlFor(source)?.format("webp")?.width(width)?.url()
	: width && height ? urlFor(source)?.format("webp")?.width(width)?.height(height)?.url()
	: !width && height ? urlFor(source)?.format("webp")?.height(height)?.url()
	: urlFor(source)?.format("webp")?.url()
const src =
	width && !height ? urlFor(source)?.width(width)?.url()
	: width && height ? urlFor(source)?.width(width)?.height(height)?.url()
	: !width && height ? urlFor(source)?.height(height)?.url()
	: urlFor(source)?.url()
---

<picture>
	<source srcset={srcset} type="image/webp" />
	<img loading="lazy" src={src} alt={alt} {...rest} />
</picture>

<style lang="scss">
	img {
		display: block;
		width: 100%;
		height: auto;
		font-style: italic;
	}
</style>