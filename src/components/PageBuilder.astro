---
import Column from "@components/Column.astro";
import PortableText from "@components/PortableText.astro";
import Row from "@components/Row.astro";
import type { VerticalAlignments } from "@lib/types";
import type { TypedObject } from "astro-portabletext/types";

export type PageBuilderProps = {
	columns: {
		_type: "column";
		ratio: number;
		verticalAlignment: VerticalAlignments;
		content: TypedObject[];
	}[];
	doesBreakout: boolean;
};

export type Props = {
	source: PageBuilderProps[];
};

const {
	source,
} = Astro.props;
---

{source ? source?.map((row, index) => {
	if (row.columns.filter((column) => {
		switch (column._type) {
			case "column": return (!column.content || column.content?.length === 0) ? true : false;
			default: return true;
		};
	})?.length === row.columns.length) {
		return null;
	};
	return (
		<Row index={index + 1} doesBreakout={row.doesBreakout}>
			{row.columns?.map((column, index) => {
				const ratio = Math.max(column.ratio, 1) || 1;
				const verticalAlignment = column.verticalAlignment;
				switch (column._type) {
					case "column": {
						if (column.content && column.content.length !== 0) {
							return (
								<Column ratio={ratio} verticalAlignment={verticalAlignment} index={index + 1}>
									<PortableText source={column.content} />
								</Column>
							);
						};
						return (
							<Column ratio={ratio} verticalAlignment={verticalAlignment} index={index + 1} />
						);
					};
					default: return null;
				};
			})}
		</Row>
	);
}) : null}