---
import Main from "@layouts/Main.astro";
import { PublicationsListingGroqQuery } from "@lib/groq";
import sanityClient from "@root/sanity";
import type { PublicationProps } from "@publications/[slug].astro";
import Listing, { assignRecordToGroup, type DatasetRecordGroups } from "@components/Listing.astro";

export type PublicationsListingProps = {
	id: "publicationsListing";
	type: "listing";
	slug: { current: string; };
	title: string;
	allPublications: PublicationProps[];
};

export async function getStaticPaths() {
	const publicationsListing: PublicationsListingProps = await sanityClient.fetch(PublicationsListingGroqQuery);
	return [{
		params: {
			publications: publicationsListing?.slug.current,
		},
		props: {
			...publicationsListing,
		},
	}];
};

const listing = Astro.props;

const allPublications: DatasetRecordGroups = {};

listing.allPublications.forEach((publication) => {
	assignRecordToGroup(publication, {
		group: allPublications,
		key: "all",
		marker: "All",
		description: "All publications",
		method: "period",
	});
});
---

<Main title={listing.title}>
	<h1 class="display-none">
		{listing.title}
	</h1>
	<div class="coming-soon">
		<p>
			Coming Soon
		</p>
	</div>
	<!-- <Listing
		source={allPublications}
		originalSet={listing.allPublications}
		keys={Object.keys(allPublications)}
		densities={["2"]}
		filters={["types", "subjects", "collections", "locations"]}
	/> -->
</Main>

<style lang="scss">
	@use "@styles/mixins";
	.coming-soon {
		flex: 1;
		display: flex;
		// margin-inline: calc(var(--body-inline-spacing) * -1);
		// animation: polka-dot-movement 100s linear infinite;
		// @include mixins.polka-dot-background();
		// @keyframes polka-dot-movement {
		// 	from {
		// 		background-position: 0 0, calc(var(--spacer-400) / 4) calc(var(--spacer-400) / 4);
		// 	}
		// 	to {
		// 		background-position: 100% 0, calc(var(--spacer-400) / 4 - 100%) calc(var(--spacer-400) / 4);
		// 	}
		// }
	}
	.coming-soon p {
		display: block;
		// padding: var(--spacer-400);
		margin: auto;
		// background: var(--color-7);
		// font-size: var(--font-size-700);
		// font-weight: 700;
	}
</style>